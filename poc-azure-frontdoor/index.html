<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale = 1.0, maximum-scale=1.0">
    <meta name="author" content="Myreli <myreli@proton.me>">

    <title> | noted.myreli.dev</title>

    <link rel="stylesheet" href="https://unpkg.com/prismjs@1.28.0/themes/prism.min.css">
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.classless.min.css">
    <style>
        :root {
            --spacing: .75rem;
        }

        html,
        body {
            overflow-x: hidden;
        }

        button {
            --background-color: transparent;
            --color: var(--primary);
        }
    </style>
</head>

<body>
    <header>
        <nav>
            <ul>
                <li>
                  <a href="/">
                    <code>noted.myreli.dev</code>
                  </a>
                </li>
            </ul>
            <ul><li><a href="/about/">Sobre</a></li>
<li><a href="/">Posts</a></li>
<li><a href="/tags/">Tags</a></li></ul>
        </nav>
        <hgroup>
            <h1 id=""></h1>
            <h2 id=""></h2>
        </hgroup>
        <hr>
    </header>
    <main>
        
<h1 id="poc-azure-frontdoor">ðŸŒ± PoC Azure FrontDoor</h1>

<p></p><p>PoC to secure Azure Function behind an Azure FrontDoor, gaining load balancing, DSA and WAF capabilities. </p>

<h2 id="tldr">TL/DR</h2>

<ul>
<li>Gist containing artefacts: <a href="https://gist.github.com/myreli/fd37b6f29957c9b9180bed984ae5f1bd" rel="noopener nofollow" target="_blank">https://gist.github.com/myreli/fd37b6f29957c9b9180bed984ae5f1bd</a> </li>
<li>Total costs R$0.21 on <a href="https://azure.microsoft.com/en-us/products/app-service/" rel="noopener nofollow" target="_blank">Azure App Service</a>&nbsp;(Due to the serverfarms, all other resources fall into always free services)</li>
</ul>

<h2 id="concept">Concept</h2>

<p>Expose azure apps and functions through a secure FrontDoor instead of direct access (which is insecure) or API Gateway setup (which is a bit more complex, but combining both is a common approach). </p>
<div class="highlight"><pre class="highlight javascript"><code><span class="nx">Client</span> <span class="err">â†’</span> <span class="nx">Azure</span> <span class="nx">FrontDoor</span> <span class="err">â†’</span> <span class="nx">Azure</span> <span class="nx">Functions</span>
</code></pre></div>
<p>[File: b5315926-c0ec-43c0-aa3c-99e4eaab82f1]</p>

<p><picture><source type="image/avif" srcset="/assets/gUAEkKiQYR-dofuMhA-mc-150w.avif 150w, /assets/gUAEkKiQYR-dofuMhA-mc-300w.avif 300w, /assets/gUAEkKiQYR-dofuMhA-mc-450w.avif 450w, /assets/gUAEkKiQYR-dofuMhA-mc-600w.avif 600w, /assets/gUAEkKiQYR-dofuMhA-mc-750w.avif 750w" sizes="100vw"><source type="image/webp" srcset="/assets/gUAEkKiQYR-dofuMhA-mc-150w.webp 150w, /assets/gUAEkKiQYR-dofuMhA-mc-300w.webp 300w, /assets/gUAEkKiQYR-dofuMhA-mc-450w.webp 450w, /assets/gUAEkKiQYR-dofuMhA-mc-600w.webp 600w, /assets/gUAEkKiQYR-dofuMhA-mc-750w.webp 750w" sizes="100vw"><source type="image/jpeg" srcset="/assets/gUAEkKiQYR-dofuMhA-mc-150w.jpeg 150w, /assets/gUAEkKiQYR-dofuMhA-mc-300w.jpeg 300w, /assets/gUAEkKiQYR-dofuMhA-mc-450w.jpeg 450w, /assets/gUAEkKiQYR-dofuMhA-mc-600w.jpeg 600w, /assets/gUAEkKiQYR-dofuMhA-mc-750w.jpeg 750w" sizes="100vw"><img src="/assets/gUAEkKiQYR-dofuMhA-mc-450w.jpeg" width="750" height="511" loading="lazy" decoding="async"></picture></p>

<h2 id="deployment">Deployment</h2>

<p>Create a resource group and <a href="https://gist.github.com/myreli/fd37b6f29957c9b9180bed984ae5f1bd#file-poc-bicep" rel="noopener nofollow" target="_blank">deploy the template</a>:</p>
<div class="highlight"><pre class="highlight javascript"><code><span class="nx">az</span> <span class="nx">group</span> <span class="nx">create</span> <span class="o">--</span><span class="nx">name</span> <span class="nx">poc</span><span class="o">-</span><span class="nx">frontdoor</span> <span class="o">--</span><span class="nx">location</span> <span class="dl">"</span><span class="s2">East US</span><span class="dl">"</span>

<span class="nx">az</span> <span class="nx">deployment</span> <span class="nx">group</span> <span class="nx">create</span> <span class="o">\</span>
    <span class="o">--</span><span class="nx">resource</span><span class="o">-</span><span class="nx">group</span> <span class="nx">poc</span><span class="o">-</span><span class="nx">frontdoor</span> <span class="o">\</span>
    <span class="o">--</span><span class="nx">template</span><span class="o">-</span><span class="nx">file</span> <span class="nx">poc</span><span class="p">.</span><span class="nx">bicep</span> <span class="o">\</span>
    <span class="o">--</span><span class="nx">parameters</span> <span class="nx">appName</span><span class="o">=</span><span class="nx">poc</span>
</code></pre></div>
<p>All parameters are optional:</p>

<ul>
<li><code class="prettyprint">location</code>&nbsp;defaults to resourceGroup location</li>
<li><code class="prettyprint">appName</code> defaults to auto-generated string</li>
<li><code class="prettyprint">frontDoorEndpointName</code> defaults to auto-generated string</li>
</ul>

<p>All other resources are deployed using a auto-generated string or its own name, eg: </p>
<div class="highlight"><pre class="highlight javascript"><code><span class="nx">resource</span> <span class="nx">frontDoorOriginGroup</span> <span class="dl">'</span><span class="s1">Microsoft.Cdn/profiles/originGroups</span><span class="dl">'</span>
  <span class="nx">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">frontDoorOriginGroupName</span><span class="dl">'</span>

<span class="nx">resource</span> <span class="nx">hostingPlan</span> <span class="dl">'</span><span class="s1">Microsoft.Web/serverfarms</span><span class="dl">'</span>
  <span class="nx">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hpe${uniqueString(resourceGroup().id)}</span><span class="dl">'</span>
</code></pre></div>
<h2 id="testing">Testing</h2>

<ul>
<li>Access the app without FrontDoor (the demo public function): [File: faf2cd3f-91fd-4e2b-9378-8fc03cd47de8]<picture><source type="image/avif" srcset="/assets/IjTm8kgR8U-WSjLaeO4WI-150w.avif 150w, /assets/IjTm8kgR8U-WSjLaeO4WI-300w.avif 300w, /assets/IjTm8kgR8U-WSjLaeO4WI-450w.avif 450w, /assets/IjTm8kgR8U-WSjLaeO4WI-600w.avif 600w" sizes="100vw"><source type="image/webp" srcset="/assets/IjTm8kgR8U-WSjLaeO4WI-150w.webp 150w, /assets/IjTm8kgR8U-WSjLaeO4WI-300w.webp 300w, /assets/IjTm8kgR8U-WSjLaeO4WI-450w.webp 450w, /assets/IjTm8kgR8U-WSjLaeO4WI-600w.webp 600w" sizes="100vw"><source type="image/jpeg" srcset="/assets/IjTm8kgR8U-WSjLaeO4WI-150w.jpeg 150w, /assets/IjTm8kgR8U-WSjLaeO4WI-300w.jpeg 300w, /assets/IjTm8kgR8U-WSjLaeO4WI-450w.jpeg 450w, /assets/IjTm8kgR8U-WSjLaeO4WI-600w.jpeg 600w" sizes="100vw"><img src="/assets/IjTm8kgR8U-WSjLaeO4WI-450w.jpeg" width="600" height="312" loading="lazy" decoding="async"></picture></li>
<li><p>Access the app with FrontDoor (the demo private function): [File: 580d19d6-93b3-40aa-9066-7f263b71eb47]<picture><source type="image/avif" srcset="/assets/j5Pb2ELjvY-3y3q1O8gIY-150w.avif 150w, /assets/j5Pb2ELjvY-3y3q1O8gIY-300w.avif 300w, /assets/j5Pb2ELjvY-3y3q1O8gIY-450w.avif 450w, /assets/j5Pb2ELjvY-3y3q1O8gIY-600w.avif 600w" sizes="100vw"><source type="image/webp" srcset="/assets/j5Pb2ELjvY-3y3q1O8gIY-150w.webp 150w, /assets/j5Pb2ELjvY-3y3q1O8gIY-300w.webp 300w, /assets/j5Pb2ELjvY-3y3q1O8gIY-450w.webp 450w, /assets/j5Pb2ELjvY-3y3q1O8gIY-600w.webp 600w" sizes="100vw"><source type="image/jpeg" srcset="/assets/j5Pb2ELjvY-3y3q1O8gIY-150w.jpeg 150w, /assets/j5Pb2ELjvY-3y3q1O8gIY-300w.jpeg 300w, /assets/j5Pb2ELjvY-3y3q1O8gIY-450w.jpeg 450w, /assets/j5Pb2ELjvY-3y3q1O8gIY-600w.jpeg 600w" sizes="100vw"><img src="/assets/j5Pb2ELjvY-3y3q1O8gIY-450w.jpeg" width="600" height="312" loading="lazy" decoding="async"></picture></p></li>
<li><p>Access the app <strong>trough</strong> FrontDoor:[File: 7b4b34da-ab56-4b5f-a1a2-fe56eedbe609]<picture><source type="image/avif" srcset="/assets/QPIUt5HlHp-rW0v3jW5TF-150w.avif 150w, /assets/QPIUt5HlHp-rW0v3jW5TF-300w.avif 300w, /assets/QPIUt5HlHp-rW0v3jW5TF-450w.avif 450w, /assets/QPIUt5HlHp-rW0v3jW5TF-600w.avif 600w" sizes="100vw"><source type="image/webp" srcset="/assets/QPIUt5HlHp-rW0v3jW5TF-150w.webp 150w, /assets/QPIUt5HlHp-rW0v3jW5TF-300w.webp 300w, /assets/QPIUt5HlHp-rW0v3jW5TF-450w.webp 450w, /assets/QPIUt5HlHp-rW0v3jW5TF-600w.webp 600w" sizes="100vw"><source type="image/jpeg" srcset="/assets/QPIUt5HlHp-rW0v3jW5TF-150w.jpeg 150w, /assets/QPIUt5HlHp-rW0v3jW5TF-300w.jpeg 300w, /assets/QPIUt5HlHp-rW0v3jW5TF-450w.jpeg 450w, /assets/QPIUt5HlHp-rW0v3jW5TF-600w.jpeg 600w" sizes="100vw"><img src="/assets/QPIUt5HlHp-rW0v3jW5TF-450w.jpeg" width="600" height="312" loading="lazy" decoding="async"></picture></p></li>
</ul>

<h2 id="clean-up">Clean Up</h2>

<p>Delete the entire resource group to prevent waste:</p>
<div class="highlight"><pre class="highlight javascript"><code><span class="nx">az</span> <span class="nx">group</span> <span class="k">delete</span> <span class="o">--</span><span class="nx">name</span> <span class="nx">poc</span><span class="o">-</span><span class="nx">frontdoor</span>
</code></pre></div>
<h2 id="next">Next</h2>

<ul>
<li>[ ] Restrict access to FrontDoor (eg <a href="https://learn.microsoft.com/en-us/azure/web-application-firewall/afds/waf-front-door-configure-ip-restriction" rel="noopener nofollow" target="_blank">IP Restrictions</a>)</li>
</ul>

<h2 id="resources">Resources</h2>

<ul>
<li><a href="https://learn.microsoft.com/en-us/azure/frontdoor/" rel="noopener nofollow" target="_blank">Azure Networking / FrontDoor</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/bicep/overview?tabs=bicep" rel="noopener nofollow" target="_blank">Azure Resource Manager / Bicep</a></li>
<li><a href="https://gist.github.com/myreli/fd37b6f29957c9b9180bed984ae5f1bd" rel="noopener nofollow" target="_blank">Gist</a> </li>
</ul>

<hr>

<blockquote>
<p>ðŸŒ± <strong>Seedlings</strong> sÃ£o ideias que recÃ©m tive e precisam de cultivo, nÃ£o foram revisadas ou refinadas. <a href="https://listed.to/@Myreli/the-garden">O que Ã© isso?</a></p>
</blockquote>
<p></p>


        
            <span id="discussion-section">
                <button onclick="loadDiscussionSection()">ver comentÃ¡rios</button>
            </span>
        
    </main>

    <footer>
        <article>
            <p>Quer receber atualizaÃ§Ãµes trimestrais por e-mail? Sem spam.</p>
            <form action="https://buttondown.email/api/emails/embed-subscribe/myreli" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/myreli', 'popupwindow')">
                <input type="email" name="email" placeholder="Digite seu e-mail" required="">
                <button type="submit">Receber atualizaÃ§Ãµes</button>
            </form>
        </article>

        <p>
            Copyright Â© <a href="https://myreli.dev">Myreli</a> 2023
        </p>
    </footer>
    <script>
        var HYVOR_TALK_WEBSITE = 545;
        var HYVOR_TALK_CONFIG  = {
            id: "false"
        }

        function loadDiscussionSection() {
          const discussions = document.getElementById('discussion-section')
          if (!discussions) return;

          discussions.children[0].setAttribute("aria-busy", true)

          const widget = document.createElement("div")
          widget.id = "hyvor-talk-view"

          const script = document.createElement("script")
          script.type = "text/javascript"
          script.src = "https://talk.hyvor.com/web-api/embed.js"

          discussions.replaceChildren(widget)
          document.body.appendChild(script)
        }
    </script>



</body></html>