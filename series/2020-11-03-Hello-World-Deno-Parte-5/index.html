<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale = 1.0, maximum-scale=1.0">
    <meta name="author" content="Myreli <myreli@proton.me>">

    <title>Hello World, Deno! - Parte 5 - Considera√ß√µes Finais | noted.myreli.dev</title>

    <link rel="stylesheet" href="https://unpkg.com/prismjs@1.28.0/themes/prism.min.css">
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.classless.min.css">
    <style>
        :root {
            --spacing: .75rem;
        }

        html,
        body {
            overflow-x: hidden;
        }

        button {
            --background-color: transparent;
            --color: var(--primary);
        }
    </style>
</head>

<body>
    <header>
        <nav>
            <ul>
                <li>
                  <a href="/">
                    <code>noted.myreli.dev</code>
                  </a>
                </li>
            </ul>
            <ul><li><a href="/about/">Sobre</a></li>
<li><a href="/">Posts</a></li>
<li><a href="/tags/">Tags</a></li></ul>
        </nav>
        <hgroup>
            <h1 id="hello-world-deno-parte-5-consideracoes-finais">Hello World, Deno! - Parte 5 - Considera√ß√µes Finais</h1>
            <h2 id="ambiente-de-desenvolvimento-formatacao-e-linting-embutidos-testes-distribuicao-de-codigo-e-mais-em-deno">Ambiente de desenvolvimento, formata√ß√£o e linting embutidos, testes, distribui√ß√£o de c√≥digo e mais em Deno ü¶ï</h2>
        </hgroup>
        <hr>
    </header>
    <main>
        <p>E a√≠! Como vai?</p>
<p>Na <a href="https://myreli.dev/blog/2020/08/23/Hello-World-Deno-Parte-4.html">√∫ltima publica√ß√£o</a> finalizamos nosso primeiro aplicativo em TypeScript utilizando Deno. Agora trago algumas curiosidades e recursos da <em>runtime</em> que tamb√©m s√£o muito legais de incorporar.</p>
<blockquote>
<p>Caiu aqui de paraquedas? Essa √© a √∫ltima parte de uma s√©rie de 5 artigos sobre Deno:</p>
</blockquote>
<ol>
<li><a href="https://myreli.dev/blog/2020/05/16/Hello-World-Deno.html">Hello World, Deno! - Parte I</a> <em>dispon√≠vel</em></li>
<li><a href="https://myreli.dev/blog/2020/05/18/Hello-World-Deno-Parte-2.html">Hello World, Deno! - Iniciando uma aplica√ß√£o - Parte II</a> <em>dispon√≠vel</em></li>
<li><a href="https://myreli.dev/blog/2020/06/29/Hello-World-Deno-Parte-3.html">Hello World, Deno! - Visitando APIs Web - Parte III</a> <em>dispon√≠vel</em></li>
<li><a href="https://myreli.dev/blog/2020/08/23/Hello-World-Deno-Parte-4.html">Hello World, Deno! - Visitando APIS Nativas - Parte IV</a> <em>dispon√≠vel</em></li>
<li><a href="https://myreli.dev/blog/2020/11/03/Hello-World-Deno-Parte-5.html">Hello World, Deno! - Considera√ß√µes finais Parte V</a> <strong>voc√™ est√° aqui</strong></li>
</ol>
<p><strong>PS.:</strong> J√° que estamos em outros t√≥picos mais avan√ßados da <em>runtime</em> e sem rela√ß√£o com a implementa√ß√£o em si, dei uma pequena estruturada no projeto para facilitar tudo que vamos cobrir.</p>
<p>Mantive na raiz somente o arquivo <code>mod.ts</code> e passei para as pastas <code>/core</code> e <code>/services</code> os arquivos <code>student.ts e</code> e <code>*.service.ts</code> respectivamente.</p>
<h2 id="ambiente-de-desenvolvimento">Ambiente de Desenvolvimento</h2>
<h3 id="como-instalar-deno">Como instalar Deno?</h3>
<p>J√° conversamos sobre como √© f√°cil instalar Deno, por ser um √∫nico arquivo execut√°vel, leve e f√°cil. Existem _<a href="https://deno.land/#installation">diversas_ op√ß√µes</a> para instalar e a maioria dos gerenciadores de pacote j√° est√£o com a instala√ß√£o atrav√©s do identificador <code>deno</code> dispon√≠veis.</p>
<p><strong>Windows:</strong></p>
<pre class="language-bash"><code class="language-bash">choco <span class="token function">install</span> deno</code></pre>
<p><strong>Linux (shell):</strong></p>
<pre class="language-bash"><code class="language-bash"><span class="token function">curl</span> -fsSL <span class="token punctuation">[</span>https://deno.land/x/install/install.sh<span class="token punctuation">]</span><span class="token punctuation">(</span>https://deno.land/x/install/install.sh<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">sh</span></code></pre>
<p>Mac:</p>
<pre class="language-bash"><code class="language-bash">brew <span class="token function">install</span> deno</code></pre>
<p>√â essencial que, ap√≥s a instala√ß√£o, o global seja inclu√≠do no <code>PATH</code> e a√≠ voc√™ j√° ter√° o comando <code>deno</code> dispon√≠vel.</p>
<h3 id="editor-visual-studio-code--extensao-oficial-de-deno">Editor: Visual Studio Code + Extens√£o Oficial de Deno! üòé</h3>
<p>No <a href="https://www.software.com/src/why-you-should-switch-to-vs-code">VSCode</a> existe agora uma extens√£o oficial que traz um suporte maneiro para o desenvolvimento com Deno - Intellisense, suporte as importa√ß√µes, e muito mais de forma autom√°tica. Instale ela a partir da fonte oficial:</p>
<p><a href="https://marketplace.visualstudio.com/items?itemName=denoland.vscode-deno">Deno - Visual Studio Marketplace</a></p>
<p>Depois basta criar um arquivo de configura√ß√µes <code>touch .vscode/settings.json</code> dentro do seu projeto e ativar a extens√£o:</p>
<pre class="language-json"><code class="language-json"><span class="token comment">// .vscode/settings.json</span><br><span class="token punctuation">{</span><br>  <span class="token property">"deno.enable"</span><span class="token operator">:</span> <span class="token boolean">true</span><br><span class="token punctuation">}</span></code></pre>
<p>Eu tamb√©m inclu√≠ algumas outras configura√ß√µes para melhorar a experi√™ncia:</p>
<pre class="language-json"><code class="language-json"><span class="token comment">// .vscode/settings.json</span><br><span class="token punctuation">{</span><br>  <span class="token property">"deno.enable"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>  <span class="token property">"[typescript]"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"editor.defaultFormatter"</span><span class="token operator">:</span> <span class="token string">"denoland.vscode-deno"</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"deno.unstable"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>  <span class="token property">"deno.lint"</span><span class="token operator">:</span> <span class="token boolean">true</span><br><span class="token punctuation">}</span></code></pre>
<p>E agora temos o formatador do arquivo configurado para o pr√≥prio do Deno, al√©m das dicas personalizadas para as configura√ß√µes padr√£o de Deno:</p>
<p><picture><source type="image/avif" srcset="/assets/TeGSke-DrSDmmY_ZL-150w.avif 150w, /assets/TeGSke-DrSDmmY_ZL-300w.avif 300w, /assets/TeGSke-DrSDmmY_ZL-450w.avif 450w, /assets/TeGSke-DrSDmmY_ZL-600w.avif 600w, /assets/TeGSke-DrSDmmY_ZL-750w.avif 750w, /assets/TeGSke-DrSDmmY_ZL-900w.avif 900w, /assets/TeGSke-DrSDmmY_ZL-1050w.avif 1050w, /assets/TeGSke-DrSDmmY_ZL-1200w.avif 1200w, /assets/TeGSke-DrSDmmY_ZL-1350w.avif 1350w" sizes="100vw"><source type="image/webp" srcset="/assets/TeGSke-DrSDmmY_ZL-150w.webp 150w, /assets/TeGSke-DrSDmmY_ZL-300w.webp 300w, /assets/TeGSke-DrSDmmY_ZL-450w.webp 450w, /assets/TeGSke-DrSDmmY_ZL-600w.webp 600w, /assets/TeGSke-DrSDmmY_ZL-750w.webp 750w, /assets/TeGSke-DrSDmmY_ZL-900w.webp 900w, /assets/TeGSke-DrSDmmY_ZL-1050w.webp 1050w, /assets/TeGSke-DrSDmmY_ZL-1200w.webp 1200w, /assets/TeGSke-DrSDmmY_ZL-1350w.webp 1350w" sizes="100vw"><source type="image/jpeg" srcset="/assets/TeGSke-DrSDmmY_ZL-150w.jpeg 150w, /assets/TeGSke-DrSDmmY_ZL-300w.jpeg 300w, /assets/TeGSke-DrSDmmY_ZL-450w.jpeg 450w, /assets/TeGSke-DrSDmmY_ZL-600w.jpeg 600w, /assets/TeGSke-DrSDmmY_ZL-750w.jpeg 750w, /assets/TeGSke-DrSDmmY_ZL-900w.jpeg 900w, /assets/TeGSke-DrSDmmY_ZL-1050w.jpeg 1050w, /assets/TeGSke-DrSDmmY_ZL-1200w.jpeg 1200w, /assets/TeGSke-DrSDmmY_ZL-1350w.jpeg 1350w" sizes="100vw"><img src="/assets/TeGSke-DrSDmmY_ZL-750w.jpeg" width="1350" height="291" alt="Deno possui padr√µes e guias de estilo pr√≥prios e a configura√ß√£o correta garante que seu projeto possa seguir essa padroniza√ß√£o." loading="lazy" decoding="async"></picture></p>
<p><picture><source type="image/avif" srcset="/assets/1PqKrx-bIRtwICPtb-150w.avif 150w, /assets/1PqKrx-bIRtwICPtb-300w.avif 300w, /assets/1PqKrx-bIRtwICPtb-450w.avif 450w, /assets/1PqKrx-bIRtwICPtb-600w.avif 600w, /assets/1PqKrx-bIRtwICPtb-750w.avif 750w, /assets/1PqKrx-bIRtwICPtb-900w.avif 900w, /assets/1PqKrx-bIRtwICPtb-1050w.avif 1050w" sizes="100vw"><source type="image/webp" srcset="/assets/1PqKrx-bIRtwICPtb-150w.webp 150w, /assets/1PqKrx-bIRtwICPtb-300w.webp 300w, /assets/1PqKrx-bIRtwICPtb-450w.webp 450w, /assets/1PqKrx-bIRtwICPtb-600w.webp 600w, /assets/1PqKrx-bIRtwICPtb-750w.webp 750w, /assets/1PqKrx-bIRtwICPtb-900w.webp 900w, /assets/1PqKrx-bIRtwICPtb-1050w.webp 1050w" sizes="100vw"><source type="image/jpeg" srcset="/assets/1PqKrx-bIRtwICPtb-150w.jpeg 150w, /assets/1PqKrx-bIRtwICPtb-300w.jpeg 300w, /assets/1PqKrx-bIRtwICPtb-450w.jpeg 450w, /assets/1PqKrx-bIRtwICPtb-600w.jpeg 600w, /assets/1PqKrx-bIRtwICPtb-750w.jpeg 750w, /assets/1PqKrx-bIRtwICPtb-900w.jpeg 900w, /assets/1PqKrx-bIRtwICPtb-1050w.jpeg 1050w" sizes="100vw"><img src="/assets/1PqKrx-bIRtwICPtb-600w.jpeg" width="1050" height="176" alt="Deixei, propositalmente, alguns erros anteriormente para podermos ver agora: como a utiliza√ß√£o da String em vez de string." loading="lazy" decoding="async"></picture></p>
<hr>
<h2 id="testes">Testes</h2>
<p>Sim! Deno prov√™ uma fun√ß√£o padr√£o para registrar e executar testes, com coleta de cobertura e tudo, al√©m de um m√≥dulo de assertividade para a escrita de testes. Bora ver?</p>
<p>Primeiro crie um arquivo <code>mod.test.ts</code> e importe o m√≥dulo <code>assert</code> de <a href="https://deno.land/std@0.70.0/testing/asserts.ts">https://deno.land/std@0.70.0/testing/asserts.ts</a>. Com isso j√° podemos criar nosso primeiro teste:</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token comment">// mod.test.ts</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> assert <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"https://deno.land/std@0.70.0/testing/asserts.ts"</span><span class="token punctuation">;</span><br><br>Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"Assertions module is working"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  <span class="token function">assert</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Agora √© s√≥ executar <code>deno test</code> e ta-dam:</p>
<p><picture><source type="image/avif" srcset="/assets/Mbrkcl-k8WA2F_U59-150w.avif 150w, /assets/Mbrkcl-k8WA2F_U59-300w.avif 300w, /assets/Mbrkcl-k8WA2F_U59-450w.avif 450w, /assets/Mbrkcl-k8WA2F_U59-600w.avif 600w, /assets/Mbrkcl-k8WA2F_U59-750w.avif 750w, /assets/Mbrkcl-k8WA2F_U59-900w.avif 900w" sizes="100vw"><source type="image/webp" srcset="/assets/Mbrkcl-k8WA2F_U59-150w.webp 150w, /assets/Mbrkcl-k8WA2F_U59-300w.webp 300w, /assets/Mbrkcl-k8WA2F_U59-450w.webp 450w, /assets/Mbrkcl-k8WA2F_U59-600w.webp 600w, /assets/Mbrkcl-k8WA2F_U59-750w.webp 750w, /assets/Mbrkcl-k8WA2F_U59-900w.webp 900w" sizes="100vw"><source type="image/jpeg" srcset="/assets/Mbrkcl-k8WA2F_U59-150w.jpeg 150w, /assets/Mbrkcl-k8WA2F_U59-300w.jpeg 300w, /assets/Mbrkcl-k8WA2F_U59-450w.jpeg 450w, /assets/Mbrkcl-k8WA2F_U59-600w.jpeg 600w, /assets/Mbrkcl-k8WA2F_U59-750w.jpeg 750w, /assets/Mbrkcl-k8WA2F_U59-900w.jpeg 900w" sizes="100vw"><img src="/assets/Mbrkcl-k8WA2F_U59-600w.jpeg" width="900" height="219" loading="lazy" decoding="async"></picture></p>
<p>Agora chegou a hora de escrever testes (neste caso, unit√°rios) para a aplica√ß√£o. V√°rias partes que podem ser testadas, mas escolhi o servi√ßo de identifica√ß√£o da casa porque cobre cen√°rios comuns.</p>
<h3 id="assertividade">Assertividade</h3>
<p>Assertividade √© o que vai definir se o nosso c√≥digo est√° funcionando como esperado ou n√£o.</p>
<p>No caso do servi√ßo, n√≥s queremos garantir que, quando a fun√ß√£o que chama a API √© chamada, ela funcione corretamente. Crie um arquivo <code>services/services.test.ts</code> com a estrutura inicial:</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> assert <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"https://deno.land/std@0.70.0/testing/asserts.ts"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> identifyHouse <span class="token keyword">from</span> <span class="token string">"./sorting_hat.service.ts"</span><span class="token punctuation">;</span><br><br>Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"something"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  <span class="token function">assert</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Testes unit√°rios procuram testar a menor parte poss√≠vel que seja "test√°vel" e costumam validar as assinaturas de entrada e de sa√≠da de uma fun√ß√£o.</p>
<p>Para o servi√ßo que implementamos temos a assinatura: <code>identifyHouse(string): string</code> ou seja, quando enviamos uma <code>string</code> esperamos receber outra <code>string</code>. E quando enviamos algo que n√£o √© uma <code>string</code>, esperamos que ocorra um erro.</p>
<p>Vamos come√ßar com o caso mais simples que √© chamar a fun√ß√£o passando uma string e esperar que ela retorne um valor v√°lido:</p>
<pre class="language-tsx"><code class="language-tsx">Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"that sorting hat service returns a truthy value"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> house<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">identifyHouse</span><span class="token punctuation">(</span><span class="token string">"teste"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token function">assert</span><span class="token punctuation">(</span>house<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Para ver funcionando, executamos <code>deno test --allow-net</code>:</p>
<p><picture><source type="image/avif" srcset="/assets/JhqN4q-i8ZdOSqKoX-150w.avif 150w, /assets/JhqN4q-i8ZdOSqKoX-300w.avif 300w, /assets/JhqN4q-i8ZdOSqKoX-450w.avif 450w, /assets/JhqN4q-i8ZdOSqKoX-600w.avif 600w" sizes="100vw"><source type="image/webp" srcset="/assets/JhqN4q-i8ZdOSqKoX-150w.webp 150w, /assets/JhqN4q-i8ZdOSqKoX-300w.webp 300w, /assets/JhqN4q-i8ZdOSqKoX-450w.webp 450w, /assets/JhqN4q-i8ZdOSqKoX-600w.webp 600w" sizes="100vw"><source type="image/jpeg" srcset="/assets/JhqN4q-i8ZdOSqKoX-150w.jpeg 150w, /assets/JhqN4q-i8ZdOSqKoX-300w.jpeg 300w, /assets/JhqN4q-i8ZdOSqKoX-450w.jpeg 450w, /assets/JhqN4q-i8ZdOSqKoX-600w.jpeg 600w" sizes="100vw"><img src="/assets/JhqN4q-i8ZdOSqKoX-450w.jpeg" width="600" height="238" loading="lazy" decoding="async"></picture></p>
<p>Existem v√°rias fun√ß√µes de assertividade que podemos utilizar, variando com cada caso. Neste cen√°rio, vamos utilizar a fun√ß√£o <code>assertArrayContains</code> (ou <code>assertArrayIncludes</code> a partir da vers√£o 0.70).</p>
<p>O que precisamos √© garantir que a casa sorteada corresponda a alguma das casas poss√≠veis poss√≠veis de Harry Potter. A fun√ß√£o de assertividade recebe dois parametros obrigat√≥rios: valores poss√≠veis (<code>actual</code>) e valores para compara√ß√£o (<code>expected</code>).</p>
<p>Al√©m disso, √© poss√≠vel explicitar a tipagem a ser utilizada na compara√ß√£o. Abaixo est√° o c√≥digo ap√≥s as modifica√ß√µes:</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> assertArrayContains <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"https://deno.land/std@0.70.0/testing/asserts.ts"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> identifyHouse <span class="token keyword">from</span> <span class="token string">"./sorting_hat.service.ts"</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token constant">HOUSES</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Gryffindor"</span><span class="token punctuation">,</span> <span class="token string">"Slytherin"</span><span class="token punctuation">,</span> <span class="token string">"Ravenclaw"</span><span class="token punctuation">,</span> <span class="token string">"Hufflepuff"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"that sorting hat service returns a valid house"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> house<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">identifyHouse</span><span class="token punctuation">(</span><span class="token string">"teste"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token generic-function"><span class="token function">assertArrayContains</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token constant">HOUSES</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>house<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Para executar basta rodar <code>deno test --allow-net</code> novamente e ver os resultados.</p>
<h3 id="stubs-e-modulos-de-terceiros">Stubs e m√≥dulos de terceiros</h3>
<p>Cada execu√ß√£o dos nossos testes est√° indo no servi√ßo (na internet) buscar as informa√ß√µes, ou seja, n√£o estamos fazendo <em>testes unit√°rios.</em> Nesse momento entram os <a href="https://martinfowler.com/articles/mocksArentStubs.html">stubs</a> - que simulam as respostas de chamadas feitas durante os testes.</p>
<p>Existem diversas formas de implementar stubs, mas aqui, vamos aproveitar para introduzir outro conceito de Deno: m√≥dulos da comunidade.</p>
<p>Al√©m dos <a href="https://deno.land/std">m√≥dulos nativos</a> Deno prov√™ um host de <a href="https://deno.land/x/">m√≥dulos de terceiros</a>, disponibilizados pela comunidade - semalhante ao que a <a href="https://www.npmjs.com/">npm</a> faz.</p>
<p>Para criar nossos stubs vamos utilizar o m√≥dulo <a href="https://deno.land/x/mock@v0.9.2">https://deno.land/x/mock@v0.9.2</a>, utilizando o sub m√≥dulo <code>stub</code> e a interface <code>Stub</code>. Se adicionarmos essas duas linhas em nosso arquivo de teste, j√° vamos ver como o <code>stub</code> funciona:</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> stub<span class="token punctuation">,</span> Stub <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"https://deno.land/x/mock@v0.9.2/stub.ts"</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> consoleStub<span class="token operator">:</span> Stub<span class="token operator">&lt;</span>Console<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">stub</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">,</span> <span class="token string">"debug"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Nesse trecho, estamos simulando o comportamento do <code>Console</code>, mais especificamente do <code>console.debug</code>, substituindo seu comportamento original por... nada. Isso significa que, ao executar os testes, tudo que for passado por ele n√£o vai ser executado como antes e, portanto, n√£o ser√° impresso no terminal.</p>
<p>Ou seja, <code>stub</code> recebe uma instancia, um m√©todo e - opcionalmente - o que deve ser retornado.</p>
<p>Queremos fazer a mesma coisa, mas para o momento em que acessamos a internet. Por isso, vamos simular o comportamento da fun√ß√£o <code>fetch</code>, que pode ser acessada atrav√©s do <code>globalThis</code></p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> fetchStub<span class="token operator">:</span> Stub<span class="token operator">&lt;</span><span class="token keyword">typeof</span> globalThis<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">stub</span><span class="token punctuation">(</span>globalThis<span class="token punctuation">,</span> <span class="token string">"fetch"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Se executarmos nossos testes agora, n√£o √© mais necess√°rio passar a flag <code>allow-net</code>, j√° que n√£o estamos mais acessando a internet.</p>
<p>No entanto, a informa√ß√£o que estamos passando n√£o corresponde a realidade da API <code>fetch</code>, ent√£o o teste ainda vai falhar. Podemos acrescentar, em vez de um retorno vazio, o retorno real que a API tem:</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> fetchStub<span class="token operator">:</span> Stub<span class="token operator">&lt;</span><span class="token keyword">typeof</span> globalThis<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">stub</span><span class="token punctuation">(</span>globalThis<span class="token punctuation">,</span> <span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><br>	<span class="token function-variable function">json</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>Por √∫ltimo, basta que em vez de retornar vazio, a gente retorne sempre uma das casas, tal qual a API real faria:</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token punctuation">{</span><br>  <span class="token function-variable function">json</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">HOUSES</span><span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">HOUSES</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Isso faz com que o servi√ßo fake sempre retorne uma alguma das casas que temos dispon√≠veis no array.</p>
<p>No fim, o nosso <code>services.test.ts</code> ficou assim:</p>
<pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> assertArrayContains <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"https://deno.land/std@0.70.0/testing/asserts.ts"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> stub<span class="token punctuation">,</span> Stub <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"https://deno.land/x/mock@v0.9.2/stub.ts"</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> identifyHouse <span class="token keyword">from</span> <span class="token string">"./sorting_hat.service.ts"</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token constant">HOUSES</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Gryffindor"</span><span class="token punctuation">,</span> <span class="token string">"Slytherin"</span><span class="token punctuation">,</span> <span class="token string">"Ravenclaw"</span><span class="token punctuation">,</span> <span class="token string">"Hufflepuff"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> consoleStub<span class="token operator">:</span> Stub<span class="token operator">&lt;</span>Console<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">stub</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">,</span> <span class="token string">"debug"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> fetchStub<span class="token operator">:</span> Stub<span class="token operator">&lt;</span><span class="token keyword">typeof</span> globalThis<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">stub</span><span class="token punctuation">(</span>globalThis<span class="token punctuation">,</span> <span class="token string">"fetch"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token function-variable function">json</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">HOUSES</span><span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token constant">HOUSES</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>Deno<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"that sorting hat service returns a valid house"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> house<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">identifyHouse</span><span class="token punctuation">(</span><span class="token string">"teste"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token generic-function"><span class="token function">assertArrayContains</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token constant">HOUSES</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>house<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  consoleStub<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  fetchStub<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>E pode ser executado com <code>deno test</code> üôÇ</p>
<p><picture><source type="image/avif" srcset="/assets/MM5WAE-oWRxQT42wG-150w.avif 150w, /assets/MM5WAE-oWRxQT42wG-300w.avif 300w, /assets/MM5WAE-oWRxQT42wG-450w.avif 450w, /assets/MM5WAE-oWRxQT42wG-600w.avif 600w" sizes="100vw"><source type="image/webp" srcset="/assets/MM5WAE-oWRxQT42wG-150w.webp 150w, /assets/MM5WAE-oWRxQT42wG-300w.webp 300w, /assets/MM5WAE-oWRxQT42wG-450w.webp 450w, /assets/MM5WAE-oWRxQT42wG-600w.webp 600w" sizes="100vw"><source type="image/jpeg" srcset="/assets/MM5WAE-oWRxQT42wG-150w.jpeg 150w, /assets/MM5WAE-oWRxQT42wG-300w.jpeg 300w, /assets/MM5WAE-oWRxQT42wG-450w.jpeg 450w, /assets/MM5WAE-oWRxQT42wG-600w.jpeg 600w" sizes="100vw"><img src="/assets/MM5WAE-oWRxQT42wG-450w.jpeg" width="600" height="130" loading="lazy" decoding="async"></picture></p>
<h2 id="ferramentas">Ferramentas</h2>
<h3 id="debug">Debug</h3>
<p>De forma experimental, Deno j√° suporta o inspetor V8, ou seja, pode ser debugado atrav√©s do VS Code, Chrome, WebStorm, etc...</p>
<p>Para utilizar, basta executar com a flag <code>--inspect</code> ou, no VSCode com a extens√£o, pressionar F5 e selecionar <code>Deno</code>.</p>
<h3 id="dependencias">Depend√™ncias</h3>
<p>Para descobrir todas as dependencias, locais ou n√£o, de um m√≥dulo, basta executar <code>deno info file.ts</code> e ent√£o as informa√ß√µes de: caminho, tipo, local compilado e todas as dependencias utilizadas ser√£o listadas.</p>
<h3 id="formatacao-e-linting">Formata√ß√£o e Linting</h3>
<p>Para formatar um arquivo seguindo o padr√£o, basta utilizar o comando <code>deno fmt file.ts</code> e todas as regras s√£o aplicadas. Al√©m disso, tamb√©m existe um linter nativo, que pode ser utilizado com <code>deno lint file.ts</code></p>
<h3 id="distribuindo">Distribuindo</h3>
<p>√â poss√≠vel instalar e distribuir qualquer c√≥digo Deno execut√°vel com as ferramentas de instala√ß√£o e <em>bundling.</em></p>
<p><code>deno bundle file.ts output.js</code> cria um <em>bundle</em> de toda a aplica√ß√£o em um √∫nico arquivo JavaScript ou envia para o <code>stdout</code>. O bundle √© um m√≥dulo ES e pode ser importado como tal.</p>
<p><code>deno install file.ts</code> instala um m√≥dulo e cria um execut√°vel <em>shell</em> para esse script, com as permiss√µes e os nomes desejados. Isso torna muito pr√°tico instalar scripts utilit√°rios dispon√≠veis em qualquer reposit√≥rio p√∫blico e torn√°-los dispon√≠veis rapidamente üôÇ</p>
<h3 id="documentacao">Documenta√ß√£o</h3>
<p>Outra ferramenta muito √∫til √© a de gera√ß√£o autom√°tica de documenta√ß√£o, que utiliza toda a documenta√ß√£o <a href="https://jsdoc.app/">JSDoc</a> dispon√≠vel nos m√≥dulos exportados da aplica√ß√£o. Para gerar, basta utilizar <code>deno doc</code> e tudo ser√° exibido no <code>stdout</code>.</p>
<p>A parte mais legal disso √© a disponibiliza√ß√£o da flag <code>--json</code>, que exporta a documenta√ß√£o em JSON, em um formato que o <a href="https://github.com/denoland/doc_website">site oficial de documenta√ß√£o</a> consegue entender para gerar de forma autom√°tica.</p>
<h2 id="consideracoes-finais">Considera√ß√µes finais</h2>
<p>Todo o c√≥digo que criamos hoje est√° dispon√≠vel no <a href="https://github.com/myreli/hello-deno-harry-potter/tree/setup-and-testing">Github</a>.</p>
<p>Espero que isso tenha te dado um gostinho para continuar explorado Deno por a√≠... √â realmente <strong>muito</strong> legal e resolve alguns problemas que o Node.js acaba tendo por natureza.</p>
<p>Tamb√©m recomendo que voc√™ visite o <a href="https://deno.land/">site de Deno</a> e explore tudo por l√°, √© muito bacana e √© a melhor forma de conhecer a <em>runtime</em> e entender o porqu√™ ela surgiu.</p>
<p>√â isso galera! Muit√≠ssimo obrigada por chegar at√© aqui. Espero que voc√™ tenha curtido.</p>
<p>At√© breve üôÇ</p>


        
            <span id="discussion-section">
                <button onclick="loadDiscussionSection()">ver coment√°rios</button>
            </span>
        
    </main>

    <footer>
        <article>
            <p>Quer receber atualiza√ß√µes trimestrais por e-mail? Sem spam.</p>
            <form action="https://buttondown.email/api/emails/embed-subscribe/myreli" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/myreli', 'popupwindow')">
                <input type="email" name="email" placeholder="Digite seu e-mail" required="">
                <button type="submit">Receber atualiza√ß√µes</button>
            </form>
        </article>

        <p>
            Copyright ¬© <a href="https://myreli.dev">Myreli</a> 2023
        </p>
    </footer>
    <script>
        var HYVOR_TALK_WEBSITE = 545;
        var HYVOR_TALK_CONFIG  = {
            id: "/2020/11/03/Hello-World-Deno-Parte-5"
        }

        function loadDiscussionSection() {
          const discussions = document.getElementById('discussion-section')
          if (!discussions) return;

          discussions.children[0].setAttribute("aria-busy", true)

          const widget = document.createElement("div")
          widget.id = "hyvor-talk-view"

          const script = document.createElement("script")
          script.type = "text/javascript"
          script.src = "https://talk.hyvor.com/web-api/embed.js"

          discussions.replaceChildren(widget)
          document.body.appendChild(script)
        }
    </script>



</body></html>