<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale = 1.0, maximum-scale=1.0">
    <meta name="author" content="Myreli <myreli@proton.me>">

    <title>Docker ‚â† Docker Desktop | blog.myreli.dev</title>

    <link rel="stylesheet" href="https://unpkg.com/prismjs@1.28.0/themes/prism.min.css">
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.classless.min.css">
    <style>
        :root {
            --spacing: .75rem;
        }

        html,
        body {
            overflow-x: hidden;
        }

        button {
            --background-color: transparent;
            --color: var(--primary);
        }
    </style>
</head>

<body>
    <header>
        <nav>
            <ul>
                <li>
                  <a href="/">
                    <code>blog.myreli.dev</code>
                  </a>
                </li>
            </ul>
            <ul><li><a href="/about/">Sobre</a></li>
<li><a href="/">Posts</a></li>
<li><a href="/tags/">Tags</a></li></ul>
        </nav>
        <hgroup>
            <h1 id="docker-docker-desktop">Docker ‚â† Docker Desktop</h1>
            <h2 id="registrando-como-utilizo-docker-sem-docker-desktop-e-porque-eu-acho-melhor">Registrando como utilizo Docker sem Docker Desktop e porque eu acho melhor.</h2>
        </hgroup>
        <hr>
    </header>
    <main>
        <h2 id="tldr">TL;DR</h2>
<ul>
<li>Docker Desktop √© s√≥ uma GUI e um <em>wraper</em> na instala√ß√£o dos componentes necess√°rios</li>
<li>√â poss√≠vel instalar esses componentes separadamente (Linux host, docker engine e docker CLI)</li>
<li>O <em>host</em> e a <em>engine</em> existem somente para Linux. Ent√£o fora do Linux √© necess√°rio uma VM Linux com boa e r√°pida intera√ß√£o com o host, principalmente em rede e volume</li>
<li>Pacotes:</li>
<li>Ubuntu: <code>(apt install) docker-ce docker-ce-cli containerd.io</code> Windows: <code>(WSL2 apt install) docker-ce docker-ce-cli containerd.io</code>Mac: <code>(brew install) colima docker</code></li>
<li>Se voc√™ tem que pagar, mas n√£o quer/consegue e quer uma GUI, experimente o <a href="https://rancherdesktop.io/">Rancher Desktop</a></li>
</ul>
<hr>
<p>Desde que o Docker anunciou que o Docker Desktop seria pago para empresas com mais de 250 colaboradores ou receita superior a 10MM as pessoas come√ßaram a surtar (na bolha dev do twitter) e at√© hoje, meses depois, continua acontecendo.</p>
<p>Nos times que participo tamb√©m rolou bastante confus√£o e a maior parte √© devido ao mal entendimento de o que √© o docker e como ele funciona. O Docker Desktop nada mais √© do que uma interface grafica para interagir com o Docker CLI e um embrulho de todos os componentes.</p>
<p>Antes mesmo disso eu j√° n√£o usava a GUI <s>(evito ter instancias de chrome que n√£o preciso, mas isso √© pra outro momento)</s>, e a maioria das pessoas tamb√©m n√£o precisa.</p>
<p>O que precisamos de verdade √©:</p>
<ul>
<li><code>docker-ce</code> <strong>Docker Engine</strong> (daemon)</li>
<li><code>docker-ce-cli</code> <strong>Docker CLI</strong></li>
<li>Al√©m disso, a <strong>engine</strong> utiliza uma <strong>runtime</strong> para os containers por tr√°s, originalmente a <code>containerd.io</code> e agora a <strong>Docker Runtime</strong> que √© baseada  nela</li>
</ul>
<p>Todos esses componentes (Engine + Runtime e CLI) vem instalados junto com o Docker Desktop, incluindo um emulador para criar a m√°quina virtual Linux. Mas, fora isso, o Docker Desktop √© s√≥ uma GUI para esse recursos. E ela vem beeem inchada, consumindo muito mais da m√°quina do que necess√°rio para o que entrega.</p>
<p>Ali√°s, no Linux o Docker Desktop nem existia foi lan√ßado recentemente <s>e eu n√£o acho que deveria, acho desperd√≠cio uma VM do mesmo sistema host! Mas existem <a href="https://docs.docker.com/desktop/faqs/linuxfaqs/#why-does-docker-desktop-for-linux-run-a-vm">motivos v√°lidos</a></s>.</p>
<h2 id="linux-ubuntu">üêß Linux (Ubuntu)</h2>
<p>Como Linux √© onde o Docker roda nativamente, podemos simplesmente instalar os tr√™s pacotes nativos: <strong>Docker Engine</strong> (<code>docker-ce</code>), <strong>Docker CLI</strong> (<code>docker-ce-cli</code>) e a <strong>Runtime</strong> (<code>containerd.io</code>).</p>
<p>Pr√© requisitos:</p>
<pre class="language-javascript"><code class="language-javascript">$ sudo apt update<br>$ sudo apt install ca<span class="token operator">-</span>certificates curl gnupg lsb<span class="token operator">-</span>release</code></pre>
<p>Registra a chave e adiciona o pacote:</p>
<pre class="language-javascript"><code class="language-javascript">$ sudo mkdir <span class="token operator">-</span>p <span class="token operator">/</span>etc<span class="token operator">/</span>apt<span class="token operator">/</span>keyrings<br>$ curl <span class="token operator">-</span>fsSL https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>download<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>com<span class="token operator">/</span>linux<span class="token operator">/</span>ubuntu<span class="token operator">/</span>gpg <span class="token operator">|</span> sudo gpg <span class="token operator">--</span>dearmor <span class="token operator">-</span>o <span class="token operator">/</span>etc<span class="token operator">/</span>apt<span class="token operator">/</span>keyrings<span class="token operator">/</span>docker<span class="token punctuation">.</span>gpg<br>$ sudo chmod a<span class="token operator">+</span>r <span class="token operator">/</span>etc<span class="token operator">/</span>apt<span class="token operator">/</span>keyrings<span class="token operator">/</span>docker<span class="token punctuation">.</span>gpg<br><br>$ echo <span class="token string">"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"</span> <span class="token operator">|</span> sudo tee <span class="token operator">/</span>etc<span class="token operator">/</span>apt<span class="token operator">/</span>sources<span class="token punctuation">.</span>list<span class="token punctuation">.</span>d<span class="token operator">/</span>docker<span class="token punctuation">.</span>list <span class="token operator">&gt;</span> <span class="token operator">/</span>dev<span class="token operator">/</span><span class="token keyword">null</span></code></pre>
<p>Finalmente, instala os tr√™s pacotes necess√°rios:</p>
<pre class="language-javascript"><code class="language-javascript">$ sudo apt install docker<span class="token operator">-</span>ce docker<span class="token operator">-</span>ce<span class="token operator">-</span>cli containerd<span class="token punctuation">.</span>io</code></pre>
<p>Ah, e se quiser adicionar o Docker Compose:</p>
<pre class="language-javascript"><code class="language-javascript">$ sudo apt install docker<span class="token operator">-</span>compose<span class="token operator">-</span>plugin</code></pre>
<p>Agora basta se adicionar no grupo <code>docker</code>:</p>
<pre class="language-javascript"><code class="language-javascript">$ sudo groupadd docker<br>$ sudo usermod <span class="token operator">-</span>aG docker $<span class="token constant">USER</span></code></pre>
<p>E <em>voil√†</em>: <code>docker run hello-world</code></p>
<h2 id="macos">üçé MacOS</h2>
<p>J√° no MacOS n√£o √© poss√≠vel rodar a <em>engine</em> ou a <em>runtime</em> nativamente, mas sim atrav√©s de uma m√°quina virtual. Ent√£o precisamos configurar uma m√°quina virutal linux para rodar essas pe√ßas, utilizando o CLI nativo.</p>
<p>As op√ß√µes mais perform√°ticas e transparentes que conhe√ßo √© <em>Lima</em>, tornada ainda mais simples atrav√©s do <em>Colima</em>.</p>
<blockquote>
<p><strong>Colima</strong> means Containers in Lima.</p>
<p>Since <strong>Lima</strong> is aka Linux on Mac. By transitivity, Colima can also mean <strong>Containers on Linux on Mac.</strong></p>
</blockquote>
<p>Instala o Docker CLI:</p>
<pre class="language-javascript"><code class="language-javascript">$ brew install docker</code></pre>
<p>Instala o Colima, que vai lidar com a <em>runtime</em> e <em>engine</em>, abstraindo completamente a VM:</p>
<pre class="language-javascript"><code class="language-javascript">$ brew install colima</code></pre>
<p>Inicia o Colima, com a runtime default do Docker (ou com a <code>--runtime containerd</code>):</p>
<pre class="language-javascript"><code class="language-javascript">$ colima start</code></pre>
<p>E <em>voil√†</em>: <code>docker run hello-world</code></p>
<p><strong>Disclaimer</strong>:**** apenas recentemente comecei a usar MacOS, ent√£o esse setup √© embrion√°rio. Nos tr√™s meses de utiliza√ß√£o at√© agora n√£o tive <em>nenhum</em> problema ainda.</p>
<h2 id="windows">ü™ü Windows</h2>
<p>Para o Windows, a mesma coisa do MacOS vale: basta rodar a <em>runtime</em> e a <em>engine</em> atrav√©s de uma m√°quina virtual e interagir atrav√©s do CLI nativo.</p>
<p>Por√©m, como o Windows tem suas peculiaridades, uma op√ß√£o melhor ainda √© simplesmente utilizar <strong>tudo</strong> dentro de uma VM, inclusive o CLI: a√≠ entra a famosa WSL.</p>
<p>Embora seja um VM ela tem um n√≠vel de integra√ß√£o com o sistema operacional base (host) muito superior.</p>
<p>Ent√£o inicie uma inst√¢ncia de Ubuntu (WSL) e execute exatamente os mesmos passos executados para instalar no Linux. Vai funcionar de forma transparente e √© uma das formas mais eficientes de ter um ambiente de desenvolvimento no Windows.</p>
<p>Eu j√° n√£o utilizo mais Windows mas, quando preciso, tenho uma boa experi√™ncia mantendo todo meu ambiente na WSL e conectando a ele pelo VSCode com a extens√£o de desenvolvimento remoto.</p>
<p>Depois de executar os passos de instala√ß√£o do Ubuntu, inicie a distribui√ß√£o WSL,</p>
<p>E <em>voil√†</em>: <code>docker run hello-world</code></p>
<h2 id="mas-vale-a-pena-ou-e-melhor">Mas vale a pena ou √© melhor?</h2>
<p><strong>Depende</strong> do seu caso de uso.</p>
<p>Eu acho melhor porque n√£o uso a interface gr√°fica e instalar somente a engine, runtime e o CLI (e VM) s√£o muito mais eficientes do que o pacot√£o Docker Desktop. Sendo assim, mesmo para uso pessoal, eu sempre ignoro o Docker Desktop e fa√ßo instala√ß√£o direta.</p>
<p>Agora, no computador da empresa para um time de desenvolvimento, √© necess√°rio avaliar tamb√©m em rela√ß√£o ao custo da licen√ßa, uma das formas de avaliar √© o custo em tempo.</p>
<p>Eu gosto de optar pelo melhor custo-benef√≠cio. Se manter a configura√ß√£o por conta pr√≥pria custa menos do que US $21 por m√™s, ent√£o sim (na minha experi√™ncia custa muito menos). Caso contr√°rio, vai no que custa mais barato e pague pelo Docker Desktop (de novo, caso a empresa fature mais do que dez milh√µes de dolares).</p>
<p>No Linux, que √© o ambiente que eu mais utilizo no dia-a-dia, eu levo menos de 30 minutos para configurar e <em>nunca</em> mais precisei mexer na instala√ß√£o. Executei esses mesmos passos aqui em umas tr√™s m√°quinas diferentes, auxiliei pessoas com eles, e na principal m√°quina que uso h√° uns cinco anos, nunca tive nenhum problema.</p>
<p>Considerando isso, meu custo para configurar √© menos de 30 minutos, muito menos do que custa a licen√ßa, e economizando muito mais os recursos do meu computador. Al√©m disso eu n√£o preciso de uma GUI <s>(em Electron, ent√£o +1 browser)</s> para executar <code>docker-compose up</code>  üòÑ, <strong>principalmente no Linux</strong>.</p>
<p>No entanto se voc√™ gastar muito tempo tentando fazer funcionar, n√£o vale a pena. Pague pelo Docker Desktop e tenha "menos" dor de cabe√ßa (j√° presenciei v√°rios devs precisando de ajuda com o Docker Desktop, ent√£o talvez n√£o seja t√£o plug-n-play assim).</p>
<p>Se voc√™ n√£o quer pagar, mas quer uma GUI, experimente o <a href="https://rancherdesktop.io/">Rancher Desktop</a>.</p>
<h2 id="referencias">Refer√™ncias</h2>
<ul>
<li><a href="https://github.com/lima-vm/lima">Lima: Linux on Mac</a></li>
<li><a href="https://github.com/abiosoft/colima">Colima: Containers on Linux on Mac</a></li>
<li><a href="https://docs.docker.com/engine/install/">Docker Engine installation overview</a></li>
<li><a href="https://www.docker.com/blog/roi-of-docker-desktop-vs-diy-considerations-risks-and-benefits-for-business/">ROI of Docker Desktop vs. DIY: Considerations, Risks, and Benefits for Business</a></li>
</ul>
<h2 id="dicas">Dicas</h2>
<ul>
<li>Setar a vari√°vel <code>DOCKER_HOST</code>  caso alguma aplica√ß√£o n√£o encontre o daemon</li>
<li>Com Colima tamb√©m √© poss√≠vel utilizar K8S, etc</li>
<li>Se voc√™ gosta de GUI e n√£o pode pagar o Docker Desktop, <a href="https://rancherdesktop.io/">Rancher Desktop</a> √© uma op√ß√£o similar e mais leve</li>
<li>Voc√™ pode executar os containers em uma VM remota e ainda sim conectar via o Docker CLI. A√≠ vai ter o lag na redemas √© √∫til para inspecionar containers de colegas ou do ambiente.</li>
</ul>
<p>[File: e9c63b77-d0ac-4b53-b100-fd3d9b9aa819]</p>
<hr>
<blockquote>
<p>üåø <strong>Budding</strong> s√£o anota√ß√µes e ideias que j√° revisei e editei minimamente. Est√£o come√ßando a tomar forma, mas ainda precisam de refinamento. <a href="/garden">O que √© isso?</a></p>
</blockquote>


        
            <hr>

            <section id="discussion-section">
                <button onclick="loadDiscussionSection()">ver coment√°rios</button>
            </section>
        
    </main>

    <footer>
        <article>
            <p>Quer receber atualiza√ß√µes mensais por e-mail? Sem spam.</p>
            <form action="https://buttondown.email/api/emails/embed-subscribe/myreli" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/myreli', 'popupwindow')">
                <input type="email" name="email" placeholder="E-mail" required="">
                <button type="submit">Inscrever e-mail</button>
            </form>
        </article>
        <hr>
        <p>
            Copyright ¬© <a href="https://myreli.dev">Myreli</a> 2022
            <br>
            Voc√™ tamb√©m pode ler <a href="https://listed.to/@myreli">meu bloco de notas</a> (coragem).
        </p>
    </footer>
    <script>
        var HYVOR_TALK_WEBSITE = 545;
        var HYVOR_TALK_CONFIG  = {
            id: "false"
        }

        function loadDiscussionSection() {
          const discussions = document.getElementById('discussion-section')
          if (!discussions) return;

          discussions.children[0].setAttribute("aria-busy", true)

          const widget = document.createElement("div")
          widget.id = "hyvor-talk-view"

          const script = document.createElement("script")
          script.type = "text/javascript"
          script.src = "https://talk.hyvor.com/web-api/embed.js"

          discussions.replaceChildren(widget)
          document.body.appendChild(script)
        }
    </script>



</body></html>