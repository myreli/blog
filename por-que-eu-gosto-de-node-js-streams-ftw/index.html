<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale = 1.0, maximum-scale=1.0">
    <meta name="author" content="Myreli <myreli@proton.me>">

    <title> | noted.myreli.dev</title>

    <link rel="stylesheet" href="https://unpkg.com/prismjs@1.28.0/themes/prism.min.css">
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.classless.min.css">
    <style>
        :root {
            --spacing: .75rem;
        }

        html,
        body {
            overflow-x: hidden;
        }

        button {
            --background-color: transparent;
            --color: var(--primary);
        }
    </style>
</head>

<body>
    <header>
        <nav>
            <ul>
                <li>
                  <a href="/">
                    <code>noted.myreli.dev</code>
                  </a>
                </li>
            </ul>
            <ul><li><a href="/about/">Sobre</a></li>
<li><a href="/">Posts</a></li>
<li><a href="/tags/">Tags</a></li></ul>
        </nav>
        <hgroup>
            <h1 id=""></h1>
            <h2 id=""></h2>
        </hgroup>
        <hr>
    </header>
    <main>
        
<h1 id="por-que-eu-gosto-de-nodejs-streams-ftw">üå± Por que eu gosto de Node.js? Streams FTW</h1>

<p></p><p>Devaneios sobre a evolu√ß√£o da experi√™ncia de desenvolvimento no JavaScript e porque eu gosto de Node. </p>

<h1 id="devaneios-javascript-node-streams">devaneios #javascript #node #streams</h1>

<p>A primeira vez que eu trabalhei com JavaScript foi uma experi√™ncia tenebrosa. Era um grande ecommerce constru√≠do em Java, com as famosas JSPs servindo HTML, JS e ~~s√≥ alegria~~ tristeza.</p>

<blockquote>
<p>üì• <strong>[side-topic]</strong> a p√°gina era "responsiva" ‚Äì carregava as duas vers√µes (mobile e web) para o cliente, testava o agente do navegador e ent√£o utilizava o famoso <code class="prettyprint">$("#element").hide()</code> do JQuery para escondar uma vers√£o ou outra.</p>
</blockquote>

<p>Nem t√£o bons tempos assim, mas definitivamente nost√°lgico.</p>

<p>O fato √© que essa era a cena do ecossistema JavaScript na √©poca e, como uma boa Dev BackEnd, eu clamava que n√£o gostava de JavaScript. Na √©poca, eu costumava explicar que o problema do JavaScript era a facilidade com que a comunidade aceitava gambiarra, a aus√™ncia de padroniza√ß√£o na sintaxe, APIs pouco amig√°veis, framework hell, etc.</p>

<p>Ent√£o esse conjunto de APIs Tamb√©m tem o fato da facilidade da linguagem para programadores iniciantes, o √¥nus e o b√¥nus. Um tempo depois nesse memso projeto tivemos a oportunidade de </p>

<p>Mas a√≠ experimentei aprender de verdade, e veio o EcmaScript 6, e mudei bastante de ideia, de tal forma que JS se tornou minha principal linguagem, em que me especializo at√© hoje.</p>

<blockquote>
<p>üì• <strong>[side-topic]</strong> por sinal essa aus√™ncia de padroniza√ß√£o no design core da linguagem √© ‚Äì na minha humilde opini√£o ‚Äì o grande vil√£o do PHP. Mas isso fica para outro dia =)</p>
</blockquote>

<h2 id="ecmascript-6-e-a-nova-era">EcmaScript 6 e a nova era</h2>

<p>As mudan√ßas foram enormes, especialmente para projetos em que o paradigma funcional n√£o fazia sentido. Codificar orientado a objetos com JavaScript se tornou mais decente, e com Typescript se tornou uma del√≠cia.</p>

<p>A comunidade come√ßou a olhar para aqueles papos de BackEnd: c√≥digo limpo, padr√µes de projeto. O surgimento de frameworks como Angular, React e Vue tamb√©m ditaram muito dessa mudan√ßa. A linguagem amadureceu.</p>

<p>Enfim, de volta ao Node. Recordo de como era anunciado como algo quase m√°gico: <em>O motor que consegue executar JavaScript no seu BackEnd!</em>, como todas as novas tecnologias fazem. Lembro tamb√©m de um amigo que comentava que JS estava virando o que o Java prometeu ser e rodar em qualquer coisa (o que n√£o √© necessariamente uma coisa boa, mas chama aten√ß√£o). </p>

<h2 id="sob-demanda">Sob Demanda</h2>

<p>Eu aprendi Streams quando resolvi me aprofundar no estudo da plataforma, realmente entender como funcionava e o que atraia tanto as pessoas.</p>

<p>Quando eu era crian√ßa utilizava o Tumblr e foi l√° eu aprendi o b√°sico gambiarrento de CSS e HTML. Me sentia a pr√≥pria <em>hackerwoman</em> quando conseguia colocar um efeito de mouse na tela.</p>

<p>Independente da plataforma de blog utilizada, eu recordo de uma mudan√ßa massiva de p√°ginas em que voc√™ apertava "pr√≥xima p√°gina" para p√°ginas que possu√≠am Rolagem Infinita. O conceito de scroll infinito √© controverso, mas a ideia √© que voc√™ n√£o deixe para o usu√°rio a responsabilidade de paginar os resultados... Eles aparecem sob demanda, para ele, quando ele precisa ler. Quando bem implementado faz uma boa diferen√ßa na experi√™ncia.</p>

<p>Por tr√°s ainda √© a mesma pagina√ß√£o, mas o efeito psicol√≥gico nos usu√°rios foi de uma p√°gina mais r√°pida, otimizada, que funcionava t√£o r√°pido quanto ele podia ler e nunca era recarregada¬≤.</p>

<p>Sob demanda.</p>

<p>E as Node.js Streams causam esse mesmo efeito ü§Ø em que, em vez de paginar os resultados em um n√∫mero m√°gico¬π, voc√™ lida com eles <strong>sob demanda</strong>. ~~Mas no caso das streams o efeito n√£o √© s√≥ psicologico, realmente economiza a mem√≥ria e √© mais r√°pido üòÖ~~</p>

<p>Ent√£o, Streams s√£o apenas sobre isso, lidar com os dados sob demanda, dispensa-los da mem√≥ria assim que forem utilizados, sem ficar esperando uma fila enorme.</p>

<p>√â quase m√°gico. Do jeito m√°gico em que as coisas simplesmente fazem sentido, n√£o que n√£o sabemos como acontece.</p>

<p>√â claro que processamento de dados sob demanda existe em outras linguagens, mas o modelo n√£o bloquante de Node.js pulveriza o recurso por toda a plataforma, al√©m das APIs serem muito simples de trabalhar.</p>

<h2 id="show-dont-tell">Show, Don't Tell</h2>

<p>Bom, vamos ver se isso √© verdade, bora codar:</p>

<p>Situa√ß√£o: Precisamos consumir uma API de playlists e escrever os dados em um arquivo, substituindo todas as ocorr√™ncias de "a" por "Nicolas Cage". Ou todas as primeiras letras por mai√∫sculas, voc√™ quem sabe.</p>

<h3 id="requisitos">Requisitos</h3>

<p>Garanta que voc√™ tenha instalado:</p>

<ul>
<li><p>Node.js vers√£o 12 na sua m√°quina</p></li>
<li><p>Coragem no seu corpo</p></li>
</ul>

<h3 id="comum-em-memoria">Comum, em mem√≥ria</h3>

<ol>
<li><p>Crie um arquivo, <code class="prettyprint">on-memory.js</code></p></li>
<li><p>Fa√ßa requisi√ß√£o a API (listed...)</p></li>
<li><p>Converta todas as ocorr√™ncias de "a" por "Nicolas Cage" e todos os</p></li>
<li><p>Escreva num arquivo (bem bonito, mantendo tudo em um loop s√≥ e usando "os novos MAP/REDUCE/FILTER" :))</p></li>
</ol>

<p>Se executarmos essa fun√ß√£o com um timer, levou aproximadamente X segundos aqui. E inspecionando o consumo de mem√≥ria, ~400mb.</p>

<p>Agora, vamos ver do que eu estava falando:</p>

<h3 id="delicia--streaming-sob-demanda">Delicia, * streaming* (sob-demanda)</h3>

<ol>
<li><p>Crie um arquivo <code class="prettyprint">on-demand.js</code></p></li>
<li><p>Fa√ßa a requisi√ß√£o para a API, mas armazene a stream</p></li>
</ol>

<p>3.</p>

<p>Tcharam! Metade do tempo, e 1/3 da mem√≥ria!</p>

<p>√â sobre isso e t√° tudo √≥timo.</p>

<hr>

<p>Com a ascen√ß√£o de arquiteturas orientadas a eventos (depois que tudo virou microservi√ßos e as pessoas lembraram que infra + tr√°fego de rede s√£o caros) ter em nossas caixas de ferramentas recursos que permite agir sob demanda n√£o s√≥ em n√≠vel arquitetural, mas em n√≠vel program√°tico, √© imprescind√≠vel.</p>

<p>Pessoalmente minha parte favorita √© pegar um c√≥digo bem lento e bagun√ßado, limpar ele e deixar perform√°tico :). Gosto de desafios com alta volumetria, mas isso n√£o significa que Streams sejam a bala de prata, nada √©.</p>

<p>E essa foi mais uma anota√ß√£o feita as 3am pelo celular e publicada quase diretamente. Fiz esse teste com um amigo hoje no trabalho, ent√£o n√£o tenho o c√≥digo aqui, mas volto para colocar. Obrigada pela sua paci√™ncia e carinho lendo meus devaneios at√© aqui.</p>

<p>Dale!</p>

<hr>

<p>¬π N√£o trabalhe com n√∫meros m√°gicos, teste! üëÅÔ∏èüëÑüëÅÔ∏è<br>
¬≤ O consumo de mem√≥ria: ü§°</p>

<hr>

<blockquote>
<p>üå± <strong>Seedlings</strong> s√£o ideias que rec√©m tive e precisam de cultivo, n√£o foram revisadas ou refinadas. <a href="https://listed.to/@Myreli/the-garden">Saiba mais.</a></p>
</blockquote>
<p></p>


        
            <span id="discussion-section">
                <button onclick="loadDiscussionSection()">ver coment√°rios</button>
            </span>
        
    </main>

    <footer>
        <article>
            <p>Quer receber atualiza√ß√µes trimestrais por e-mail? Sem spam.</p>
            <form action="https://buttondown.email/api/emails/embed-subscribe/myreli" method="post" target="popupwindow" onsubmit="window.open('https://buttondown.email/myreli', 'popupwindow')">
                <input type="email" name="email" placeholder="Digite seu e-mail" required="">
                <button type="submit">Receber atualiza√ß√µes</button>
            </form>
        </article>

        <p>
            Copyright ¬© <a href="https://myreli.dev">Myreli</a> 2023
        </p>
    </footer>
    <script>
        var HYVOR_TALK_WEBSITE = 545;
        var HYVOR_TALK_CONFIG  = {
            id: "false"
        }

        function loadDiscussionSection() {
          const discussions = document.getElementById('discussion-section')
          if (!discussions) return;

          discussions.children[0].setAttribute("aria-busy", true)

          const widget = document.createElement("div")
          widget.id = "hyvor-talk-view"

          const script = document.createElement("script")
          script.type = "text/javascript"
          script.src = "https://talk.hyvor.com/web-api/embed.js"

          discussions.replaceChildren(widget)
          document.body.appendChild(script)
        }
    </script>



</body></html>